(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("86f681be6799f4750b83c8c1509420b2");
;
var COUNTRIES = [];

COUNTRIES.push({value: 'US', label: 'United States'})
COUNTRIES.push({value: 'AF', label: 'Afghanistan'})
COUNTRIES.push({value: 'AL', label: 'Albania'})
COUNTRIES.push({value: 'DZ', label: 'Algeria'})
COUNTRIES.push({value: 'AS', label: 'American Samoa'})
COUNTRIES.push({value: 'AD', label: 'Andorra'})
COUNTRIES.push({value: 'AO', label: 'Angola'})
COUNTRIES.push({value: 'AI', label: 'Anguilla'})
COUNTRIES.push({value: 'AQ', label: 'Antarctica'})
COUNTRIES.push({value: 'AG', label: 'Antigua and Barbuda'})
COUNTRIES.push({value: 'AR', label: 'Argentina'})
COUNTRIES.push({value: 'AM', label: 'Armenia'})
COUNTRIES.push({value: 'AW', label: 'Aruba'})
COUNTRIES.push({value: 'AU', label: 'Australia'})
COUNTRIES.push({value: 'AT', label: 'Austria'})
COUNTRIES.push({value: 'AZ', label: 'Azerbaijan'})
COUNTRIES.push({value: 'AP', label: 'Azores'})
COUNTRIES.push({value: 'BS', label: 'Bahamas'})
COUNTRIES.push({value: 'BH', label: 'Bahrain'})
COUNTRIES.push({value: 'BD', label: 'Bangladesh'})
COUNTRIES.push({value: 'BB', label: 'Barbados'})
COUNTRIES.push({value: 'BY', label: 'Belarus'})
COUNTRIES.push({value: 'BE', label: 'Belgium'})
COUNTRIES.push({value: 'BZ', label: 'Belize'})
COUNTRIES.push({value: 'BJ', label: 'Benin'})
COUNTRIES.push({value: 'BM', label: 'Bermuda'})
COUNTRIES.push({value: 'BT', label: 'Bhutan'})
COUNTRIES.push({value: 'BO', label: 'Bolivia'})
COUNTRIES.push({value: 'BA', label: 'Bosnia And Herzegowina'})
COUNTRIES.push({value: 'XB', label: 'Bosnia-Herzegovina'})
COUNTRIES.push({value: 'BW', label: 'Botswana'})
COUNTRIES.push({value: 'BV', label: 'Bouvet Island'})
COUNTRIES.push({value: 'BR', label: 'Brazil'})
COUNTRIES.push({value: 'IO', label: 'British Indian Ocean Territory'})
COUNTRIES.push({value: 'VG', label: 'British Virgin Islands'})
COUNTRIES.push({value: 'BN', label: 'Brunei Darussalam'})
COUNTRIES.push({value: 'BG', label: 'Bulgaria'})
COUNTRIES.push({value: 'BF', label: 'Burkina Faso'})
COUNTRIES.push({value: 'BI', label: 'Burundi'})
COUNTRIES.push({value: 'KH', label: 'Cambodia'})
COUNTRIES.push({value: 'CM', label: 'Cameroon'})
COUNTRIES.push({value: 'CA', label: 'Canada'})
COUNTRIES.push({value: 'CV', label: 'Cape Verde'})
COUNTRIES.push({value: 'KY', label: 'Cayman Islands'})
COUNTRIES.push({value: 'CF', label: 'Central African Republic'})
COUNTRIES.push({value: 'TD', label: 'Chad'})
COUNTRIES.push({value: 'CL', label: 'Chile'})
COUNTRIES.push({value: 'CN', label: 'China'})
COUNTRIES.push({value: 'CX', label: 'Christmas Island'})
COUNTRIES.push({value: 'CC', label: 'Cocos (Keeling) Islands'})
COUNTRIES.push({value: 'CO', label: 'Colombia'})
COUNTRIES.push({value: 'KM', label: 'Comoros'})
COUNTRIES.push({value: 'CG', label: 'Congo'})
COUNTRIES.push({value: 'CD', label: 'Congo, The Democratic Republic O'})
COUNTRIES.push({value: 'CK', label: 'Cook Islands'})
COUNTRIES.push({value: 'XE', label: 'Corsica'})
COUNTRIES.push({value: 'CR', label: 'Costa Rica'})
COUNTRIES.push({value: 'CI', label: 'Cote d` Ivoire (Ivory Coast)'})
COUNTRIES.push({value: 'HR', label: 'Croatia'})
COUNTRIES.push({value: 'CU', label: 'Cuba'})
COUNTRIES.push({value: 'CY', label: 'Cyprus'})
COUNTRIES.push({value: 'CZ', label: 'Czech Republic'})
COUNTRIES.push({value: 'DK', label: 'Denmark'})
COUNTRIES.push({value: 'DJ', label: 'Djibouti'})
COUNTRIES.push({value: 'DM', label: 'Dominica'})
COUNTRIES.push({value: 'DO', label: 'Dominican Republic'})
COUNTRIES.push({value: 'TP', label: 'East Timor'})
COUNTRIES.push({value: 'EC', label: 'Ecuador'})
COUNTRIES.push({value: 'EG', label: 'Egypt'})
COUNTRIES.push({value: 'SV', label: 'El Salvador'})
COUNTRIES.push({value: 'GQ', label: 'Equatorial Guinea'})
COUNTRIES.push({value: 'ER', label: 'Eritrea'})
COUNTRIES.push({value: 'EE', label: 'Estonia'})
COUNTRIES.push({value: 'ET', label: 'Ethiopia'})
COUNTRIES.push({value: 'FK', label: 'Falkland Islands (Malvinas)'})
COUNTRIES.push({value: 'FO', label: 'Faroe Islands'})
COUNTRIES.push({value: 'FJ', label: 'Fiji'})
COUNTRIES.push({value: 'FI', label: 'Finland'})
COUNTRIES.push({value: 'FR', label: 'France (Includes Monaco)'})
COUNTRIES.push({value: 'FX', label: 'France, Metropolitan'})
COUNTRIES.push({value: 'GF', label: 'French Guiana'})
COUNTRIES.push({value: 'PF', label: 'French Polynesia'})
COUNTRIES.push({value: 'TA', label: 'French Polynesia (Tahiti)'})
COUNTRIES.push({value: 'TF', label: 'French Southern Territories'})
COUNTRIES.push({value: 'GA', label: 'Gabon'})
COUNTRIES.push({value: 'GM', label: 'Gambia'})
COUNTRIES.push({value: 'GE', label: 'Georgia'})
COUNTRIES.push({value: 'DE', label: 'Germany'})
COUNTRIES.push({value: 'GH', label: 'Ghana'})
COUNTRIES.push({value: 'GI', label: 'Gibraltar'})
COUNTRIES.push({value: 'GR', label: 'Greece'})
COUNTRIES.push({value: 'GL', label: 'Greenland'})
COUNTRIES.push({value: 'GD', label: 'Grenada'})
COUNTRIES.push({value: 'GP', label: 'Guadeloupe'})
COUNTRIES.push({value: 'GU', label: 'Guam'})
COUNTRIES.push({value: 'GT', label: 'Guatemala'})
COUNTRIES.push({value: 'GN', label: 'Guinea'})
COUNTRIES.push({value: 'GW', label: 'Guinea-Bissau'})
COUNTRIES.push({value: 'GY', label: 'Guyana'})
COUNTRIES.push({value: 'HT', label: 'Haiti'})
COUNTRIES.push({value: 'HM', label: 'Heard And Mc Donald Islands'})
COUNTRIES.push({value: 'VA', label: 'Holy See (Vatican City State)'})
COUNTRIES.push({value: 'HN', label: 'Honduras'})
COUNTRIES.push({value: 'HK', label: 'Hong Kong'})
COUNTRIES.push({value: 'HU', label: 'Hungary'})
COUNTRIES.push({value: 'IS', label: 'Iceland'})
COUNTRIES.push({value: 'IN', label: 'India'})
COUNTRIES.push({value: 'ID', label: 'Indonesia'})
COUNTRIES.push({value: 'IR', label: 'Iran'})
COUNTRIES.push({value: 'IQ', label: 'Iraq'})
COUNTRIES.push({value: 'IE', label: 'Ireland'})
COUNTRIES.push({value: 'EI', label: 'Ireland (Eire)'})
COUNTRIES.push({value: 'IL', label: 'Israel'})
COUNTRIES.push({value: 'IT', label: 'Italy'})
COUNTRIES.push({value: 'JM', label: 'Jamaica'})
COUNTRIES.push({value: 'JP', label: 'Japan'})
COUNTRIES.push({value: 'JO', label: 'Jordan'})
COUNTRIES.push({value: 'KZ', label: 'Kazakhstan'})
COUNTRIES.push({value: 'KE', label: 'Kenya'})
COUNTRIES.push({value: 'KI', label: 'Kiribati'})
COUNTRIES.push({value: 'KP', label: 'Korea, Democratic People\'S Repub'})
COUNTRIES.push({value: 'KW', label: 'Kuwait'})
COUNTRIES.push({value: 'KG', label: 'Kyrgyzstan'})
COUNTRIES.push({value: 'LA', label: 'Laos'})
COUNTRIES.push({value: 'LV', label: 'Latvia'})
COUNTRIES.push({value: 'LB', label: 'Lebanon'})
COUNTRIES.push({value: 'LS', label: 'Lesotho'})
COUNTRIES.push({value: 'LR', label: 'Liberia'})
COUNTRIES.push({value: 'LY', label: 'Libya'})
COUNTRIES.push({value: 'LI', label: 'Liechtenstein'})
COUNTRIES.push({value: 'LT', label: 'Lithuania'})
COUNTRIES.push({value: 'LU', label: 'Luxembourg'})
COUNTRIES.push({value: 'MO', label: 'Macao'})
COUNTRIES.push({value: 'MK', label: 'Macedonia'})
COUNTRIES.push({value: 'MG', label: 'Madagascar'})
COUNTRIES.push({value: 'ME', label: 'Madeira Islands'})
COUNTRIES.push({value: 'MW', label: 'Malawi'})
COUNTRIES.push({value: 'MY', label: 'Malaysia'})
COUNTRIES.push({value: 'MV', label: 'Maldives'})
COUNTRIES.push({value: 'ML', label: 'Mali'})
COUNTRIES.push({value: 'MT', label: 'Malta'})
COUNTRIES.push({value: 'MH', label: 'Marshall Islands'})
COUNTRIES.push({value: 'MQ', label: 'Martinique'})
COUNTRIES.push({value: 'MR', label: 'Mauritania'})
COUNTRIES.push({value: 'MU', label: 'Mauritius'})
COUNTRIES.push({value: 'YT', label: 'Mayotte'})
COUNTRIES.push({value: 'MX', label: 'Mexico'})
COUNTRIES.push({value: 'FM', label: 'Micronesia, Federated States Of'})
COUNTRIES.push({value: 'MD', label: 'Moldova, Republic Of'})
COUNTRIES.push({value: 'MC', label: 'Monaco'})
COUNTRIES.push({value: 'MN', label: 'Mongolia'})
COUNTRIES.push({value: 'MS', label: 'Montserrat'})
COUNTRIES.push({value: 'MA', label: 'Morocco'})
COUNTRIES.push({value: 'MZ', label: 'Mozambique'})
COUNTRIES.push({value: 'MM', label: 'Myanmar (Burma)'})
COUNTRIES.push({value: 'NA', label: 'Namibia'})
COUNTRIES.push({value: 'NR', label: 'Nauru'})
COUNTRIES.push({value: 'NP', label: 'Nepal'})
COUNTRIES.push({value: 'NL', label: 'Netherlands'})
COUNTRIES.push({value: 'AN', label: 'Netherlands Antilles'})
COUNTRIES.push({value: 'NC', label: 'New Caledonia'})
COUNTRIES.push({value: 'NZ', label: 'New Zealand'})
COUNTRIES.push({value: 'NI', label: 'Nicaragua'})
COUNTRIES.push({value: 'NE', label: 'Niger'})
COUNTRIES.push({value: 'NG', label: 'Nigeria'})
COUNTRIES.push({value: 'NU', label: 'Niue'})
COUNTRIES.push({value: 'NF', label: 'Norfolk Island'})
COUNTRIES.push({value: 'MP', label: 'Northern Mariana Islands'})
COUNTRIES.push({value: 'NO', label: 'Norway'})
COUNTRIES.push({value: 'OM', label: 'Oman'})
COUNTRIES.push({value: 'PK', label: 'Pakistan'})
COUNTRIES.push({value: 'PW', label: 'Palau'})
COUNTRIES.push({value: 'PS', label: 'Palestinian Territory, Occupied'})
COUNTRIES.push({value: 'PA', label: 'Panama'})
COUNTRIES.push({value: 'PG', label: 'Papua New Guinea'})
COUNTRIES.push({value: 'PY', label: 'Paraguay'})
COUNTRIES.push({value: 'PE', label: 'Peru'})
COUNTRIES.push({value: 'PH', label: 'Philippines'})
COUNTRIES.push({value: 'PN', label: 'Pitcairn'})
COUNTRIES.push({value: 'PL', label: 'Poland'})
COUNTRIES.push({value: 'PT', label: 'Portugal'})
COUNTRIES.push({value: 'PR', label: 'Puerto Rico'})
COUNTRIES.push({value: 'QA', label: 'Qatar'})
COUNTRIES.push({value: 'RE', label: 'Reunion'})
COUNTRIES.push({value: 'RO', label: 'Romania'})
COUNTRIES.push({value: 'RU', label: 'Russian Federation'})
COUNTRIES.push({value: 'RW', label: 'Rwanda'})
COUNTRIES.push({value: 'KN', label: 'Saint Kitts And Nevis'})
COUNTRIES.push({value: 'SM', label: 'San Marino'})
COUNTRIES.push({value: 'ST', label: 'Sao Tome and Principe'})
COUNTRIES.push({value: 'SA', label: 'Saudi Arabia'})
COUNTRIES.push({value: 'SN', label: 'Senegal'})
COUNTRIES.push({value: 'XS', label: 'Serbia-Montenegro'})
COUNTRIES.push({value: 'SC', label: 'Seychelles'})
COUNTRIES.push({value: 'SL', label: 'Sierra Leone'})
COUNTRIES.push({value: 'SG', label: 'Singapore'})
COUNTRIES.push({value: 'SK', label: 'Slovak Republic'})
COUNTRIES.push({value: 'SI', label: 'Slovenia'})
COUNTRIES.push({value: 'SB', label: 'Solomon Islands'})
COUNTRIES.push({value: 'SO', label: 'Somalia'})
COUNTRIES.push({value: 'ZA', label: 'South Africa'})
COUNTRIES.push({value: 'GS', label: 'South Georgia And The South Sand'})
COUNTRIES.push({value: 'KR', label: 'South Korea'})
COUNTRIES.push({value: 'ES', label: 'Spain'})
COUNTRIES.push({value: 'LK', label: 'Sri Lanka'})
COUNTRIES.push({value: 'NV', label: 'St. Christopher and Nevis'})
COUNTRIES.push({value: 'SH', label: 'St. Helena'})
COUNTRIES.push({value: 'LC', label: 'St. Lucia'})
COUNTRIES.push({value: 'PM', label: 'St. Pierre and Miquelon'})
COUNTRIES.push({value: 'VC', label: 'St. Vincent and the Grenadines'})
COUNTRIES.push({value: 'SD', label: 'Sudan'})
COUNTRIES.push({value: 'SR', label: 'Suriname'})
COUNTRIES.push({value: 'SJ', label: 'Svalbard And Jan Mayen Islands'})
COUNTRIES.push({value: 'SZ', label: 'Swaziland'})
COUNTRIES.push({value: 'SE', label: 'Sweden'})
COUNTRIES.push({value: 'CH', label: 'Switzerland'})
COUNTRIES.push({value: 'SY', label: 'Syrian Arab Republic'})
COUNTRIES.push({value: 'TW', label: 'Taiwan'})
COUNTRIES.push({value: 'TJ', label: 'Tajikistan'})
COUNTRIES.push({value: 'TZ', label: 'Tanzania'})
COUNTRIES.push({value: 'TH', label: 'Thailand'})
COUNTRIES.push({value: 'TG', label: 'Togo'})
COUNTRIES.push({value: 'TK', label: 'Tokelau'})
COUNTRIES.push({value: 'TO', label: 'Tonga'})
COUNTRIES.push({value: 'TT', label: 'Trinidad and Tobago'})
COUNTRIES.push({value: 'XU', label: 'Tristan da Cunha'})
COUNTRIES.push({value: 'TN', label: 'Tunisia'})
COUNTRIES.push({value: 'TR', label: 'Turkey'})
COUNTRIES.push({value: 'TM', label: 'Turkmenistan'})
COUNTRIES.push({value: 'TC', label: 'Turks and Caicos Islands'})
COUNTRIES.push({value: 'TV', label: 'Tuvalu'})
COUNTRIES.push({value: 'UG', label: 'Uganda'})
COUNTRIES.push({value: 'UA', label: 'Ukraine'})
COUNTRIES.push({value: 'AE', label: 'United Arab Emirates'})
COUNTRIES.push({value: 'UK', label: 'United Kingdom'})
COUNTRIES.push({value: 'GB', label: 'Great Britain'})
COUNTRIES.push({value: 'UM', label: 'United States Minor Outlying Isl'})
COUNTRIES.push({value: 'UY', label: 'Uruguay'})
COUNTRIES.push({value: 'UZ', label: 'Uzbekistan'})
COUNTRIES.push({value: 'VU', label: 'Vanuatu'})
COUNTRIES.push({value: 'XV', label: 'Vatican City'})
COUNTRIES.push({value: 'VE', label: 'Venezuela'})
COUNTRIES.push({value: 'VN', label: 'Vietnam'})
COUNTRIES.push({value: 'VI', label: 'Virgin Islands (U.S.)'})
COUNTRIES.push({value: 'WF', label: 'Wallis and Furuna Islands'})
COUNTRIES.push({value: 'EH', label: 'Western Sahara'})
COUNTRIES.push({value: 'WS', label: 'Western Samoa'})
COUNTRIES.push({value: 'YE', label: 'Yemen'})
COUNTRIES.push({value: 'YU', label: 'Yugoslavia'})
COUNTRIES.push({value: 'ZR', label: 'Zaire'})
COUNTRIES.push({value: 'ZM', label: 'Zambia'})
COUNTRIES.push({value: 'ZW', label: 'Zimbabwe'})

var STATES = {
  US: [],
  CA: [],
  UK: [],
  BR: [],
  AU: [],
  NL: [],
  EI: [],
};

STATES.US.push({label: 'Alaska', value: 'AK'});
STATES.US.push({label: 'Alabama', value: 'AL'});
STATES.US.push({label: 'Arkansas', value: 'AR'});
STATES.US.push({label: 'American Samoa', value: 'AS'});
STATES.US.push({label: 'Arizona', value: 'AZ'});
STATES.US.push({label: 'California', value: 'CA'});
STATES.US.push({label: 'Colorado', value: 'CO'});
STATES.US.push({label: 'Connecticut', value: 'CT'});
STATES.US.push({label: 'D.C.', value: 'DC'});
STATES.US.push({label: 'Delaware', value: 'DE'});
STATES.US.push({label: 'Florida', value: 'FL'});
STATES.US.push({label: 'Micronesia', value: 'FM'});
STATES.US.push({label: 'Georgia', value: 'GA'});
STATES.US.push({label: 'Guam', value: 'GU'});
STATES.US.push({label: 'Hawaii', value: 'HI'});
STATES.US.push({label: 'Iowa', value: 'IA'});
STATES.US.push({label: 'Idaho', value: 'ID'});
STATES.US.push({label: 'Illinois', value: 'IL'});
STATES.US.push({label: 'Indiana', value: 'IN'});
STATES.US.push({label: 'Kansas', value: 'KS'});
STATES.US.push({label: 'Kentucky', value: 'KY'});
STATES.US.push({label: 'Louisiana', value: 'LA'});
STATES.US.push({label: 'Massachusetts', value: 'MA'});
STATES.US.push({label: 'Maryland', value: 'MD'});
STATES.US.push({label: 'Maine', value: 'ME'});
STATES.US.push({label: 'Marshall Islands', value: 'MH'});
STATES.US.push({label: 'Michigan', value: 'MI'});
STATES.US.push({label: 'Minnesota', value: 'MN'});
STATES.US.push({label: 'Missouri', value: 'MO'});
STATES.US.push({label: 'Marianas', value: 'MP'});
STATES.US.push({label: 'Mississippi', value: 'MS'});
STATES.US.push({label: 'Montana', value: 'MT'});
STATES.US.push({label: 'North Carolina', value: 'NC'});
STATES.US.push({label: 'North Dakota', value: 'ND'});
STATES.US.push({label: 'Nebraska', value: 'NE'});
STATES.US.push({label: 'New Hampshire', value: 'NH'});
STATES.US.push({label: 'New Jersey', value: 'NJ'});
STATES.US.push({label: 'New Mexico', value: 'NM'});
STATES.US.push({label: 'Nevada', value: 'NV'});
STATES.US.push({label: 'New York', value: 'NY'});
STATES.US.push({label: 'Ohio', value: 'OH'});
STATES.US.push({label: 'Oklahoma', value: 'OK'});
STATES.US.push({label: 'Oregon', value: 'OR'});
STATES.US.push({label: 'Pennsylvania', value: 'PA'});
STATES.US.push({label: 'Puerto Rico', value: 'PR'});
STATES.US.push({label: 'Palau', value: 'PW'});
STATES.US.push({label: 'Rhode Island', value: 'RI'});
STATES.US.push({label: 'South Carolina', value: 'SC'});
STATES.US.push({label: 'South Dakota', value: 'SD'});
STATES.US.push({label: 'Tennessee', value: 'TN'});
STATES.US.push({label: 'Texas', value: 'TX'});
STATES.US.push({label: 'Utah', value: 'UT'});
STATES.US.push({label: 'Virginia', value: 'VA'});
STATES.US.push({label: 'Virgin Islands', value: 'VI'});
STATES.US.push({label: 'Vermont', value: 'VT'});
STATES.US.push({label: 'Washington', value: 'WA'});
STATES.US.push({label: 'Wisconsin', value: 'WI'});
STATES.US.push({label: 'West Virginia', value: 'WV'});
STATES.US.push({label: 'Wyoming', value: 'WY'});
STATES.US.push({label: 'Military Americas', value: 'AA'});
STATES.US.push({label: 'Military Europe/ME/Canada', value: 'AE'});
STATES.US.push({label: 'Military Pacific', value: 'AP'});
STATES.CA.push({label: 'Alberta', value: 'AB'});
STATES.CA.push({label: 'Manitoba', value: 'MB'});
STATES.CA.push({label: 'Alberta', value: 'AB'});
STATES.CA.push({label: 'British Columbia', value: 'BC'});
STATES.CA.push({label: 'Manitoba', value: 'MB'});
STATES.CA.push({label: 'New Brunswick', value: 'NB'});
STATES.CA.push({label: 'Newfoundland and Labrador', value: 'NL'});
STATES.CA.push({label: 'Nova Scotia', value: 'NS'});
STATES.CA.push({label: 'Northwest Territories', value: 'NT'});
STATES.CA.push({label: 'Nunavut', value: 'NU'});
STATES.CA.push({label: 'Ontario', value: 'ON'});
STATES.CA.push({label: 'Prince Edward Island', value: 'PE'});
STATES.CA.push({label: 'Quebec', value: 'QC'});
STATES.CA.push({label: 'Saskatchewan', value: 'SK'});
STATES.CA.push({label: 'Yukon Territory', value: 'YT'});
STATES.AU.push({label: 'Australian Antarctic Territory', value: 'AA'});
STATES.AU.push({label: 'Australian Capital Territory', value: 'AC'});
STATES.AU.push({label: 'Northern Territory', value: 'NT'});
STATES.AU.push({label: 'New South Wales', value: 'NS'});
STATES.AU.push({label: 'Queensland', value: 'QL'});
STATES.AU.push({label: 'South Australia', value: 'SA'});
STATES.AU.push({label: 'Tasmania', value: 'TA'});
STATES.AU.push({label: 'Victoria', value: 'VI'});
STATES.AU.push({label: 'Western Australia', value: 'WA'});
STATES.BR.push({label: 'Acre', value: 'AC'});
STATES.BR.push({label: 'Alagoas', value: 'AL'});
STATES.BR.push({label: 'Amazonas', value: 'AM'});
STATES.BR.push({label: 'Amapa', value: 'AP'});
STATES.BR.push({label: 'Baia', value: 'BA'});
STATES.BR.push({label: 'Ceara', value: 'CE'});
STATES.BR.push({label: 'Distrito Federal', value: 'DF'});
STATES.BR.push({label: 'Espirito Santo', value: 'ES'});
STATES.BR.push({label: 'Fernando de Noronha', value: 'FN'});
STATES.BR.push({label: 'Goias', value: 'GO'});
STATES.BR.push({label: 'Maranhao', value: 'MA'});
STATES.BR.push({label: 'Minas Gerais', value: 'MG'});
STATES.BR.push({label: 'Mato Grosso do Sul', value: 'MS'});
STATES.BR.push({label: 'Mato Grosso', value: 'MT'});
STATES.BR.push({label: 'Para', value: 'PA'});
STATES.BR.push({label: 'Paraiba', value: 'PB'});
STATES.BR.push({label: 'Pernambuco', value: 'PE'});
STATES.BR.push({label: 'Piaui', value: 'PI'});
STATES.BR.push({label: 'Parana', value: 'PR'});
STATES.BR.push({label: 'Rio de Janeiro', value: 'RJ'});
STATES.BR.push({label: 'Rio Grande do Norte', value: 'RN'});
STATES.BR.push({label: 'Rondonia', value: 'RO'});
STATES.BR.push({label: 'Roraima', value: 'RR'});
STATES.BR.push({label: 'Rio Grande do Sul', value: 'RS'});
STATES.BR.push({label: 'Santa Catarina', value: 'SC'});
STATES.BR.push({label: 'Sergipe', value: 'SE'});
STATES.BR.push({label: 'Sao Paulo', value: 'SP'});
STATES.BR.push({label: 'Tocatins', value: 'TO'});
STATES.NL.push({label: 'Drente', value: 'DR'});
STATES.NL.push({label: 'Flevoland', value: 'FL'});
STATES.NL.push({label: 'Friesland', value: 'FR'});
STATES.NL.push({label: 'Gelderland', value: 'GL'});
STATES.NL.push({label: 'Groningen', value: 'GR'});
STATES.NL.push({label: 'Limburg', value: 'LB'});
STATES.NL.push({label: 'Noord Brabant', value: 'NB'});
STATES.NL.push({label: 'Noord Holland', value: 'NH'});
STATES.NL.push({label: 'Overijssel', value: 'OV'});
STATES.NL.push({label: 'Utrecht', value: 'UT'});
STATES.NL.push({label: 'Zuid Holland', value: 'ZH'});
STATES.NL.push({label: 'Zeeland', value: 'ZL'});
STATES.UK.push({label: 'Avon', value: 'AV'});
STATES.UK.push({label: 'Bedfordshire', value: 'BE'});
STATES.UK.push({label: 'Berkshire', value: 'BE'});
STATES.UK.push({label: 'Buckinghamshire', value: 'BU'});
STATES.UK.push({label: 'Cambridgeshire', value: 'CA'});
STATES.UK.push({label: 'Cheshire', value: 'CH'});
STATES.UK.push({label: 'Cleveland', value: 'CL'});
STATES.UK.push({label: 'Cornwall', value: 'CO'});
STATES.UK.push({label: 'Cumbria', value: 'CU'});
STATES.UK.push({label: 'Derbyshire', value: 'DE'});
STATES.UK.push({label: 'Devon', value: 'DE'});
STATES.UK.push({label: 'Dorset', value: 'DO'});
STATES.UK.push({label: 'Durham', value: 'DU'});
STATES.UK.push({label: 'Essex', value: 'ES'});
STATES.UK.push({label: 'Gloucestershire', value: 'GL'});
STATES.UK.push({label: 'Greater London', value: 'GL'});
STATES.UK.push({label: 'Greater Manchester', value: 'GM'});
STATES.UK.push({label: 'Hampshire', value: 'HA'});
STATES.UK.push({label: 'Hereford & Worcestershire', value: 'HE'});
STATES.UK.push({label: 'Hertfordshire', value: 'HE'});
STATES.UK.push({label: 'Humberside', value: 'HU'});
STATES.UK.push({label: 'Isle of Man', value: 'IO'});
STATES.UK.push({label: 'Isle of Wight', value: 'IO'});
STATES.UK.push({label: 'Kent', value: 'KE'});
STATES.UK.push({label: 'Lancashire', value: 'LA'});
STATES.UK.push({label: 'Leicestershire', value: 'LE'});
STATES.UK.push({label: 'Lincolnshire', value: 'LI'});
STATES.UK.push({label: 'Merseyside', value: 'ME'});
STATES.UK.push({label: 'Norfolk', value: 'NO'});
STATES.UK.push({label: 'Northamptonshire', value: 'NH'});
STATES.UK.push({label: 'Northumberland', value: 'NT'});
STATES.UK.push({label: 'Nottinghamshire', value: 'NO'});
STATES.UK.push({label: 'Oxfordshire', value: 'OX'});
STATES.UK.push({label: 'Shropshire', value: 'SH'});
STATES.UK.push({label: 'Somerset', value: 'SO'});
STATES.UK.push({label: 'Staffordshire', value: 'ST'});
STATES.UK.push({label: 'Suffolk', value: 'SU'});
STATES.UK.push({label: 'Surrey', value: 'SU'});
STATES.UK.push({label: 'Sussex', value: 'SU'});
STATES.UK.push({label: 'Warwickshire', value: 'WA'});
STATES.UK.push({label: 'West Midlands', value: 'WM'});
STATES.UK.push({label: 'Wiltshire', value: 'WI'});
STATES.UK.push({label: 'Yorkshire', value: 'YO'});
STATES.EI.push({label: 'County Antrim', value: 'CO'});
STATES.EI.push({label: 'County Armagh', value: 'CO'});
STATES.EI.push({label: 'County Down', value: 'CO'});
STATES.EI.push({label: 'County Fermanagh', value: 'CO'});
STATES.EI.push({label: 'County Londonderry', value: 'CO'});
STATES.EI.push({label: 'County Tyrone', value: 'CO'});
STATES.EI.push({label: 'County Cavan', value: 'CO'});
STATES.EI.push({label: 'County Donegal', value: 'CO'});
STATES.EI.push({label: 'County Monaghan', value: 'CO'});
STATES.EI.push({label: 'County Dublin', value: 'CO'});
STATES.EI.push({label: 'County Carlow', value: 'CO'});
STATES.EI.push({label: 'County Kildare', value: 'CO'});
STATES.EI.push({label: 'County Kilkenny', value: 'CO'});
STATES.EI.push({label: 'County Laois', value: 'CO'});
STATES.EI.push({label: 'County Longford', value: 'CO'});
STATES.EI.push({label: 'County Louth', value: 'CO'});
STATES.EI.push({label: 'County Meath', value: 'CO'});
STATES.EI.push({label: 'County Offaly', value: 'CO'});
STATES.EI.push({label: 'County Westmeath', value: 'CO'});
STATES.EI.push({label: 'County Wexford', value: 'CO'});
STATES.EI.push({label: 'County Wicklow', value: 'CO'});
STATES.EI.push({label: 'County Galway', value: 'CO'});
STATES.EI.push({label: 'County Mayo', value: 'CO'});
STATES.EI.push({label: 'County Leitrim', value: 'CO'});
STATES.EI.push({label: 'County Roscommon', value: 'CO'});
STATES.EI.push({label: 'County Sligo', value: 'CO'});
STATES.EI.push({label: 'County Clare', value: 'CO'});
STATES.EI.push({label: 'County Cork', value: 'CO'});
STATES.EI.push({label: 'County Kerry', value: 'CO'});
STATES.EI.push({label: 'County Limerick', value: 'CO'});
STATES.EI.push({label: 'County Tipperary', value: 'CO'});
STATES.EI.push({label: 'County Waterford', value: 'CO'});
;
    window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"light-bottom"};


;
var COOKIE_TIMEOUT_MS = 900000;
var STORAGE_KEY = 'LUCYBOT_RECIPE_CREDS';

App.controller('Kaltura', function($scope) {
  $scope.user = {};
  $scope.pathname = window.location.pathname;
  $scope.hash = window.location.hash;
  $scope.setUser = function(creds) {
    $scope.user = creds;
    window.onAuthorization(creds, function(err, ks) {
      $scope.user.ks = creds.ks = ks;
      var now = new Date();
      var expires = new Date(now.getTime() + COOKIE_TIMEOUT_MS);
      var cookie = STORAGE_KEY + '=' + encodeURIComponent(JSON.stringify(creds)) + '; expires=' + expires.toUTCString() + '; Path=/';
      document.cookie = cookie;
      var call = $('#APICall');
      if (call.length) {
        var keys = call.scope().keys || {};
        keys.ks = creds.ks;
        keys.partnerId = creds.partnerId;
        keys.userId = creds.userId;
        keys.secret = creds.secret;
        setTimeout(function() {
          call.scope().$apply();
        });
      }
    })
  }

  var cookies = document.cookie.split(';').map(function(c) {return c.trim()});
  var credCookie = cookies.filter(function(c) {
    return c.indexOf(STORAGE_KEY) === 0;
  })[0];
  if (credCookie) {
    var stored = credCookie.substring(STORAGE_KEY.length + 1) || '{}';
    var user;
    try {
      user = JSON.parse(decodeURIComponent(stored));
    } catch(e) {}
    if (user) $scope.setUser(user);
  }

  $scope.search = function() {
    window.open('https://vpaas.kaltura.com/search/#stp=1&stq=' + encodeURIComponent($scope.searchQuery), '_blank');
  }
})

App.controller('KalturaNav', function($scope) {
  $scope.navbarLinks = [
    {title: "VPaaS", href: "https://vpaas.kaltura.com"},
    {title: "API Docs", href: "/api-docs"},
    {title: "API Console", href: "/console"},
    {title: "Client Libraries", href: "/api-docs/#/Client%20Libraries"},
    {title: "Interactive Workflows", href: "/recipes"},
  ]
})

App.controller('KalturaLogin', function($scope) {
  $scope.responses = {};
  $scope.loginInputs = [
    {label: 'E-mail', model:"email", type:"email", required: true},
    {label: 'Password', model:"password", type:"password", required: true},
  ];

  $scope.partnerInputs = [
    {label: 'Partner ID', model: "partnerId", type: "select", required: true},
  ]

  $scope.inputs = $scope.loginInputs;

  $scope.submit = function() {
    $scope.alert = {};
    $scope.loading = true;
    if ($scope.inputs === $scope.loginInputs) {
      $scope.login();
    } else {
      $scope.selectPartner();
    }
  }

  $scope.selectPartner = function() {
    $.ajax({
      url: '/auth/selectPartner',
      method: 'POST',
      data: JSON.stringify($scope.responses),
      headers: {'Content-Type': 'application/json'},
    })
    .done(function(data) {
      var creds = {
        secret: data.adminSecret,
        userId: $scope.responses.email,
        partnerId: $scope.responses.partnerId,
      }
      $scope.setUser(creds);
      $scope.alert = {success: "You're ready to go!"};
      $scope.inputs = $scope.loginInputs;
      setTimeout(function() {
        $scope.alert = {};
        $('#KalturaLogin').modal('hide');
      }, 1500);
    })
    .fail(function(xhr) {
      mixpanel.track('login_error', {
        partnerId: $scope.responses.partnerId,
        email: $scope.responses.email,
        error: xhr.responseText,
      })
      $scope.alert = {danger: "Error logging in: " + xhr.responseText}
    })
    .always(function() {
      $scope.$apply()
      $scope.loading = false;
    })
  }

  $scope.login = function() {
    mixpanel.track('login_submit', {
      partnerId: $scope.responses.partnerId,
      email: $scope.responses.email,
    });
    $.ajax({
      url: '/auth/login',
      method: 'POST',
      data: JSON.stringify($scope.responses),
      headers: {'Content-Type': 'application/json'},
    })
    .done(function(response) {
      mixpanel.identify($scope.responses.email);
      mixpanel.people.set({
        '$email': $scope.responses.email,
        partnerId: $scope.responses.partnerId,
      })
      mixpanel.track('login_success', {
        partnerId: $scope.responses.partnerId,
        email: $scope.responses.email,
      })
      $scope.responses.adminSecret = response.adminSecret;
      $scope.alert = {info: "Choose the Kaltura account you'd like to use"};
      $scope.partnerInputs[0].options = response.map(function(partner) {
        return {label: partner.name + ' (' + partner.id + ')', value: partner.id}
      })
      $scope.inputs = $scope.partnerInputs;
      $scope.responses.partnerId = $scope.partnerInputs[0].options[0].value;
      $scope.selectedOption = $scope.partnerInputs[0].options[0].label;
    })
    .fail(function(xhr) {
      mixpanel.track('login_error', {
        partnerId: $scope.responses.partnerId,
        email: $scope.responses.email,
        error: xhr.responseText,
      })
      $scope.alert = {danger: "Error logging in: " + xhr.responseText}
    })
    .always(function() {
      $scope.loading = false;
      $scope.$apply();
    })
  }
});

App.controller('KalturaSignup', function($scope) {
  $scope.responses = {};
  $scope.alert = {};
  $scope.inputs = [
    {label: 'First name', model: 'firstName', type: 'text', required: true},
    {label: 'Last name', model: 'lastName', type: 'text', required: true},
    {label: 'Company', model: 'company', type: 'text', required: true},
    {label: 'E-mail', model:'email', type:'email', required: true},
    {label: 'Country', model:'country', type: 'select', options: COUNTRIES, required: true},
    {label: 'State', model: 'state', type: 'select', hidden: true},
    {label: 'How are you planning to use Kaltura?', model: 'usage', type: 'textarea'},
    {label: 'Would you like a Kaltura expert to help architect/design a solution with you?',
     model: 'help', type: 'radio', options: [{label: 'Yes', value: true}, {label: 'No', value: false}]}
  ];

  $scope.$watch('responses.country', function() {
    var states = STATES[$scope.responses.country];
    if (states) {
      $scope.inputs[5].hidden = false;
      $scope.inputs[5].options = states;
    } else {
      $scope.responses.state = null;
      $scope.inputs[5].hidden = true;
    }
  });

  $scope.submit = function() {
    $scope.alert = {};
    $scope.loading = true;
    mixpanel.track('signup_submit', $scope.responses);
    $.ajax({
      url: '/auth/signup',
      method: 'POST',
      data: JSON.stringify($scope.responses),
      headers: {'Content-Type': 'application/json'},
    })
    .done(function(response) {
      mixpanel.identify($scope.responses.email);
      mixpanel.people.set({
        '$email': $scope.responses.email,
        partnerId: response.id,
        country: $scope.responses.country,
        state: $scope.responses.state,
        company: $scope.responses.company,
        firstName: $scope.responses.firstName,
        lastName: $scope.responses.lastName,
      })
      mixpanel.track('signup_success', {
        partnerId: response.id,
        email: $scope.responses.email,
      })
      var creds = {
        partnerId: response.id,
        userId: response.adminUserId,
        secret: response.adminSecret,
      }
      $scope.setUser(creds);
      $scope.alert = {success: "You're ready to go!"};
      setTimeout(function() {
        $scope.alert = {};
        $('#KalturaSignup').modal('hide');
      }, 1500);
    })
    .fail(function(xhr) {
      $scope.responses.error = xhr.responseText;
      mixpanel.track('signup_error', $scope.responses);
      $scope.alert = {danger: "Error creating account: " + xhr.responseText}
    })
    .always(function() {
      mixpanel.track('signup_success', $scope.responses);
      $scope.loading = false;
      $scope.$apply();
    })
  }
});
;
window.KC = null;
window.onAuthorization = function(creds, cb) {
  if (!creds.partnerId || !creds.secret) return cb();
  if (creds.ks && window.KC) return cb();
  var config = new KalturaConfiguration(creds.partnerId);
  config.serviceUrl = "https://www.kaltura.com/";
  window.KC = new KalturaClient(config);
  KC.session.start(function(success, ks) {
    if (!success || (ks.code && ks.message)) {
      var trackObj = ks || {};
      console.lot('fail', trackObj);
      mixpanel.track('kaltura_session_error', trackObj);
      cb(ks);
      return console.log('Kaltura Error', success, ks);
    }
    mixpanel.track('kaltura_session', {
      partnerId: creds.partnerId
    });
    KC.setKs(ks);
    var filter = new KalturaUiConfFilter();
    filter.objTypeEqual = KalturaUiConfObjType.PLAYER;
    KC.uiConf.listAction(function(success, results) {
      var uiConfs = results.objects || [];
      if (window.RECIPE && RECIPE.name === 'captions') {
        uiConfs = uiConfs.filter(function(uiConf) {
          return uiConf.confFile.indexOf('Plugin id="closedCaptions') !== -1;
        })
      }
      uiConfs = uiConfs.filter(function(uiConf) {
        return uiConf.tags &&
               uiConf.tags.indexOf('html5studio') !== -1 &&
               (uiConf.html5Url || '').indexOf('/v2') !== -1;
      })
      if (uiConfs.length === 0 && window.RECIPE) {
        if (RECIPE.name === 'dynamic_thumbnails') {
          $('#Recipe').scope().globalError = 'This recipe requires an HTML5 enabled uiConf. Please use the KMC to create one.';
        } else if (RECIPE.name === 'captions') {
          $('#Recipe').scope().globalError = 'This recipe requires a uiConf with captions enabled. Please use the KMC to create one.';
        }
        uiConfs = results.objects || [];
      }
      if ($('#APICall').length && uiConfs.length) {
        $('#APICall').scope().globalAnswers['uiConf'] = uiConfs[0].id;
      }
      cb(null, ks);
    }, filter);
  }, creds.secret,
  creds.userId,
  KalturaSessionType.ADMIN,
  creds.partnerId) 
}

;
window.checkResponse = function(data, status, xhr) {
  var msg = {type: 'success', message: "Success"};
  if (data === null) return msg;
  if (data instanceof Document) {
    var $data = $(data);
    if ($data.find('error').length) {
      var code = $data.find('code').text();
      var message = $data.find('error message').text();
      msg = {type: 'danger', message: code + ': ' + message};
    }
  } else if (typeof data === 'object') {
    var err = data.code && data.message;
    if (err) msg = {type: 'danger', message: data.code + ': ' + data.message};
    if (window.RECIPE && data.objectType === 'KalturaUiConfListResponse') {
      data.objects = data.objects.filter(function(uiConf) {
        return (uiConf.html5Url || '').indexOf('/v2') !== -1 || uiConf.objType === KalturaUiConfObjType.KRECORD;
      });
      if (!data.objects.length) return {type: 'danger', message: 'No v2 uiConfs found.'}
    }
  }
  if (msg.message.indexOf('SERVICE_FORBIDDEN') !== -1) {
    $('#KalturaLogin').modal('show');
  }
  return msg;
}


;
if (window.location.pathname.match(/\/edit$/)) {
  $(document).ready(function() {
    $('#KalturaGitHubModal').modal('show');
  });
}

window.hideGitHubModal = function() {
  $('#KalturaGitHubModal').modal('hide');
}

var GitHub = function (opts) {
  this.o = opts;
}
GitHub.prototype.req = function(method, path, query, data, innerCb) {
  var self = this;
  if (!innerCb) {
    innerCb = data;
    data = null;
  }
  query = query || {};
  headers = {'Content-Type': 'application/json'};
  if (self.o.token) query.access_token = self.o.token;
  $.ajax({
    method: method,
    url: 'https://api.github.com' + path + '?' + $.param(query),
    data: data ? JSON.stringify(data) : undefined,
    headers: headers,
  }).success(innerCb).fail(function(xhr) {
    if (xhr.responseJSON && xhr.responseJSON.errors && xhr.responseJSON.errors[0]) {
      var err = xhr.responseJSON.errors[0];
      if (err && err.message.indexOf('A pull request already exists') === 0) return innerCb({});
    }
    if (self.o.errBack) self.o.errBack(xhr.responseText);
    else innerCb(null);
  });
}

function runGitHubOAuth(callback) {
  if (window.GITHUB_TOKEN) return callback(null, window.GITHUB_TOKEN);
  window.onOAuthComplete = function(qs) {
    if (qs.error) return callback(qs);
    $.ajax({
      method: 'POST',
      url: '/github/access_token?code=' + qs.code,
      headers: {'Content-Type': 'application/json'},
    }).success(function(data) {
      window.GITHUB_TOKEN = data.access_token;
      callback(null, data.access_token);
    }).fail(function(xhr) {
      callback(xhr.responseText);
    });
  };
  var params = {
    client_id: ENV.github_client_id,
    redirect_uri: ENV.github_callback_url,
    scope: 'public_repo',
  }
  window.open('https://github.com/login/oauth/authorize?' + $.param(params), '_blank');
}

window.loadRecipe = function(name, callback) {
  runGitHubOAuth(function(err, tok) {
    if (err) return callback(err);
    var github = new GitHub({errBack: callback, token: tok});
    github.req('GET', '/user', {}, function(user) {
      var path = '/repos/' + user.login + '/kaltura-api-recipes';
      path += '/contents/recipes-v2/' + name + '.json';
      github.req('GET', path, {}, function(file) {
        var recipe = JSON.parse(atob(file.content));
        recipe.defaults = recipe.defaults || {};
        recipe.defaults.recipeName = recipe.name;
        recipe.defaults.format = 1;
        callback(null, recipe);
      });
    });
  })
}

window.saveRecipe = function(recipe, callback) {
  if (recipe.name === 'new_recipe') return callback("Please specify a unique ID for your recipe.")
  var repoPath = '/repos/kaltura/kaltura-api-recipes';
  var filePath = '/contents/recipes-v2/' + recipe.name + '.json';
  var descLoc = (recipe.description || '').indexOf('This recipe uses the following operations');
  if (descLoc === 0) delete recipe.description;
  else if (descLoc !== -1) recipe.description = recipe.description.substring(0, descLoc).split('\n\n');
  if (recipe.defaults) {
    delete recipe.defaults.serviceURL;
    delete recipe.defaults.format;
    delete recipe.defaults.recipeName;
    if (!Object.keys(recipe.defaults).length) delete recipe.defaults;
  }
  recipe.steps.forEach(function(s) {
    s.description = s.description || '';
    if (!s.description.length) delete s.description;
    else s.description = s.description.split('\n\n');
  });

  runGitHubOAuth(function(err, tok) {
    if (err) return callback(err);
    var github = new GitHub({errBack: callback, token: tok});
    github.req('POST', repoPath + '/forks', {}, function(repo) {
      var theirRepoPath = '/repos/' + repo.full_name;
      github.o.errBack = null;
      github.req('GET', theirRepoPath + filePath, {}, function(file) {
        github.o.errBack = callback;
        github.req('PUT', theirRepoPath + filePath, {}, {
          message: "Update recipe: " + recipe.name,
          content: btoa(unescape(encodeURIComponent(JSON.stringify(recipe, null, 2)))),
          sha: file ? file.sha : undefined,
        }, function(msg) {
          github.req('POST', repoPath + '/pulls', {}, {
            title: 'Update recipe: ' + recipe.name,
            base: 'development',
            head: repo.owner.login + ':development',
          }, function(pr) {
            callback(null, 'Successfully opened a Pull Request at ' + (pr.html_url || 'https://github.com/kaltura/kaltura-api-recipes'))
          })
        });
      });
    });
  });
}
